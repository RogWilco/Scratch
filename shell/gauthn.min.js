#!/usr/local/bin/node

/**
 * ===========================================================================
 * Google Authenticator Key Generator
 * ===========================================================================
 * @author Nick Williams
 * @version 1.0.0
 * @description
 * 
 * This script generates a matching key for a Google
 * Authenticator account. It requires the desired secret to be stored in an
 * environment variable GAUTHN. Add this to your .profile/.bashrc/etc:
 *      
 *      export GAUTHN=[your_secret]
 *
 * ---------------------------------------------------------------------------
 * License
 * ---------------------------------------------------------------------------
 * Copyright (c) 2013, Nick Williams
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the <organization> nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
 * DAMAGE.
 *
 * ---------------------------------------------------------------------------
 * Additional Credits
 * ---------------------------------------------------------------------------
 * SHA related code derived from the jsSHA library:
 *      
 *      https://github.com/Caligatio/jsSHA
 * 
 *      Copyright (c) 2008-2012, Brian Turek
 *      All rights reserved.
 *      
 *      Redistribution and use in source and binary forms, with or without
 *      modification, are permitted provided that the following conditions are
 *      met:
 *      
 *       * Redistributions of source code must retain the above copyright
 *         notice, this list of conditions and the following disclaimer.
 *       * Redistributions in binary form must reproduce the above copyright
 *         notice, this list of conditions and the following disclaimer in the
 *         documentation and/or other materials provided with the
 *         distribution.
 *       * The names of the contributors may not be used to endorse or promote
 *         products derived from this software without specific prior written
 *         permission.
 *      
 *      THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 *      "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 *      LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 *      A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 *      OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,INDIRECT, INCIDENTAL,
 *      SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 *      LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 *      DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 *      THEORY OFLIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 *      (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 *      OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
function Int_64(r,e){this.highOrder=r,this.lowOrder=e}function str2binb(r,e){var n,t,o,i=[],h=[],w=0
if("UTF8"==e)for(t=0;t<r.length;t+=1)for(n=r.charCodeAt(t),h=[],n>2048?(h[0]=224|(61440&n)>>>12,h[1]=128|(4032&n)>>>6,h[2]=128|63&n):n>128?(h[0]=192|(1984&n)>>>6,h[1]=128|63&n):h[0]=n,o=0;o<h.length;o+=1)i[w>>>2]|=h[o]<<24-8*(w%4),w+=1
else if("UTF16"==e)for(t=0;t<r.length;t+=1)n=r.charCodeAt(t),i[w>>>2]|=r.charCodeAt(t)<<16-8*(w%4),w+=2
return{value:i,binLen:8*w}}function hex2binb(r){var e,n,t=[],o=r.length
if(0!==o%2)throw"String of HEX type must be in byte increments"
for(e=0;o>e;e+=2){if(n=parseInt(r.substr(e,2),16),isNaN(n))throw"String of HEX type contains invalid characters"
t[e>>>3]|=n<<24-4*(e%8)}return{value:t,binLen:4*o}}function b642binb(r){var e,n,t,o,i,h,w=[],d=0,O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
if(-1===r.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string"
if(h=r.indexOf("="),r=r.replace(/\=/g,""),-1!==h&&h<r.length)throw"Invalid '=' found in base-64 string"
for(n=0;n<r.length;n+=4){for(i=r.substr(n,4),o=0,t=0;t<i.length;t+=1)e=O.indexOf(i[t]),o|=e<<18-6*t
for(t=0;t<i.length-1;t+=1)w[d>>2]|=(255&o>>>16-8*t)<<24-8*(d%4),d+=1}return{value:w,binLen:8*d}}function binb2hex(r,e){var n,t,o="0123456789abcdef",i="",h=4*r.length
for(n=0;h>n;n+=1)t=r[n>>>2]>>>8*(3-n%4),i+=o.charAt(15&t>>>4)+o.charAt(15&t)
return e.outputUpper?i.toUpperCase():i}function binb2b64(r,e){var n,t,o,i="",h=4*r.length,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
for(n=0;h>n;n+=3)for(o=(255&r[n>>>2]>>>8*(3-n%4))<<16|(255&r[n+1>>>2]>>>8*(3-(n+1)%4))<<8|255&r[n+2>>>2]>>>8*(3-(n+2)%4),t=0;4>t;t+=1)i+=8*n+6*t<=32*r.length?w.charAt(63&o>>>6*(3-t)):e.b64Pad
return i}function getOutputOpts(r){var e={outputUpper:!1,b64Pad:"="}
try{r.hasOwnProperty("outputUpper")&&(e.outputUpper=r.outputUpper),r.hasOwnProperty("b64Pad")&&(e.b64Pad=r.b64Pad)}catch(n){}if("boolean"!=typeof e.outputUpper)throw"Invalid outputUpper formatting option"
if("string"!=typeof e.b64Pad)throw"Invalid b64Pad formatting option"
return e}function rotl_32(r,e){return r<<e|r>>>32-e}function rotr_32(r,e){return r>>>e|r<<32-e}function rotr_64(r,e){var n=null,t=new Int_64(r.highOrder,r.lowOrder)
return n=32>=e?new Int_64(t.highOrder>>>e|4294967295&t.lowOrder<<32-e,t.lowOrder>>>e|4294967295&t.highOrder<<32-e):new Int_64(t.lowOrder>>>e-32|4294967295&t.highOrder<<64-e,t.highOrder>>>e-32|4294967295&t.lowOrder<<64-e)}function shr_32(r,e){return r>>>e}function shr_64(r,e){var n=null
return n=32>=e?new Int_64(r.highOrder>>>e,r.lowOrder>>>e|4294967295&r.highOrder<<32-e):new Int_64(0,r.highOrder>>>e-32)}function parity_32(r,e,n){return r^e^n}function ch_32(r,e,n){return r&e^~r&n}function ch_64(r,e,n){return new Int_64(r.highOrder&e.highOrder^~r.highOrder&n.highOrder,r.lowOrder&e.lowOrder^~r.lowOrder&n.lowOrder)}function maj_32(r,e,n){return r&e^r&n^e&n}function maj_64(r,e,n){return new Int_64(r.highOrder&e.highOrder^r.highOrder&n.highOrder^e.highOrder&n.highOrder,r.lowOrder&e.lowOrder^r.lowOrder&n.lowOrder^e.lowOrder&n.lowOrder)}function sigma0_32(r){return rotr_32(r,2)^rotr_32(r,13)^rotr_32(r,22)}function sigma0_64(r){var e=rotr_64(r,28),n=rotr_64(r,34),t=rotr_64(r,39)
return new Int_64(e.highOrder^n.highOrder^t.highOrder,e.lowOrder^n.lowOrder^t.lowOrder)}function sigma1_32(r){return rotr_32(r,6)^rotr_32(r,11)^rotr_32(r,25)}function sigma1_64(r){var e=rotr_64(r,14),n=rotr_64(r,18),t=rotr_64(r,41)
return new Int_64(e.highOrder^n.highOrder^t.highOrder,e.lowOrder^n.lowOrder^t.lowOrder)}function gamma0_32(r){return rotr_32(r,7)^rotr_32(r,18)^shr_32(r,3)}function gamma0_64(r){var e=rotr_64(r,1),n=rotr_64(r,8),t=shr_64(r,7)
return new Int_64(e.highOrder^n.highOrder^t.highOrder,e.lowOrder^n.lowOrder^t.lowOrder)}function gamma1_32(r){return rotr_32(r,17)^rotr_32(r,19)^shr_32(r,10)}function gamma1_64(r){var e=rotr_64(r,19),n=rotr_64(r,61),t=shr_64(r,6)
return new Int_64(e.highOrder^n.highOrder^t.highOrder,e.lowOrder^n.lowOrder^t.lowOrder)}function safeAdd_32_2(r,e){var n=(65535&r)+(65535&e),t=(r>>>16)+(e>>>16)+(n>>>16)
return(65535&t)<<16|65535&n}function safeAdd_32_4(r,e,n,t){var o=(65535&r)+(65535&e)+(65535&n)+(65535&t),i=(r>>>16)+(e>>>16)+(n>>>16)+(t>>>16)+(o>>>16)
return(65535&i)<<16|65535&o}function safeAdd_32_5(r,e,n,t,o){var i=(65535&r)+(65535&e)+(65535&n)+(65535&t)+(65535&o),h=(r>>>16)+(e>>>16)+(n>>>16)+(t>>>16)+(o>>>16)+(i>>>16)
return(65535&h)<<16|65535&i}function safeAdd_64_2(r,e){var n,t,o,i
return n=(65535&r.lowOrder)+(65535&e.lowOrder),t=(r.lowOrder>>>16)+(e.lowOrder>>>16)+(n>>>16),o=(65535&t)<<16|65535&n,n=(65535&r.highOrder)+(65535&e.highOrder)+(t>>>16),t=(r.highOrder>>>16)+(e.highOrder>>>16)+(n>>>16),i=(65535&t)<<16|65535&n,new Int_64(i,o)}function safeAdd_64_4(r,e,n,t){var o,i,h,w
return o=(65535&r.lowOrder)+(65535&e.lowOrder)+(65535&n.lowOrder)+(65535&t.lowOrder),i=(r.lowOrder>>>16)+(e.lowOrder>>>16)+(n.lowOrder>>>16)+(t.lowOrder>>>16)+(o>>>16),h=(65535&i)<<16|65535&o,o=(65535&r.highOrder)+(65535&e.highOrder)+(65535&n.highOrder)+(65535&t.highOrder)+(i>>>16),i=(r.highOrder>>>16)+(e.highOrder>>>16)+(n.highOrder>>>16)+(t.highOrder>>>16)+(o>>>16),w=(65535&i)<<16|65535&o,new Int_64(w,h)}function safeAdd_64_5(r,e,n,t,o){var i,h,w,d
return i=(65535&r.lowOrder)+(65535&e.lowOrder)+(65535&n.lowOrder)+(65535&t.lowOrder)+(65535&o.lowOrder),h=(r.lowOrder>>>16)+(e.lowOrder>>>16)+(n.lowOrder>>>16)+(t.lowOrder>>>16)+(o.lowOrder>>>16)+(i>>>16),w=(65535&h)<<16|65535&i,i=(65535&r.highOrder)+(65535&e.highOrder)+(65535&n.highOrder)+(65535&t.highOrder)+(65535&o.highOrder)+(h>>>16),h=(r.highOrder>>>16)+(e.highOrder>>>16)+(n.highOrder>>>16)+(t.highOrder>>>16)+(o.highOrder>>>16)+(i>>>16),d=(65535&h)<<16|65535&i,new Int_64(d,w)}function coreSHA1(r,e){var n,t,o,i,h,w,d,O,l,a=[],u=ch_32,f=parity_32,g=maj_32,s=rotl_32,_=safeAdd_32_2,c=safeAdd_32_5,A=[1732584193,4023233417,2562383102,271733878,3285377520],S=[1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782]
for(r[e>>>5]|=128<<24-e%32,r[(e+65>>>9<<4)+15]=e,l=r.length,d=0;l>d;d+=16){for(n=A[0],t=A[1],o=A[2],i=A[3],h=A[4],O=0;80>O;O+=1)a[O]=16>O?r[O+d]:s(a[O-3]^a[O-8]^a[O-14]^a[O-16],1),w=20>O?c(s(n,5),u(t,o,i),h,S[O],a[O]):40>O?c(s(n,5),f(t,o,i),h,S[O],a[O]):60>O?c(s(n,5),g(t,o,i),h,S[O],a[O]):c(s(n,5),f(t,o,i),h,S[O],a[O]),h=i,i=o,o=s(t,30),t=n,n=w
A[0]=_(n,A[0]),A[1]=_(t,A[1]),A[2]=_(o,A[2]),A[3]=_(i,A[3]),A[4]=_(h,A[4])}return A}function coreSHA2(r,e,n){var t,o,i,h,w,d,O,l,a,u,f,g,s,_,c,A,S,b,p,H,m,P,v,U,E,T,I,L,G,D,R=[]
if(("SHA-224"===n||"SHA-256"===n)&&2&SUPPORTED_ALGS)g=64,s=(e+65>>>9<<4)+15,A=16,S=1,I=Number,b=safeAdd_32_2,p=safeAdd_32_4,H=safeAdd_32_5,m=gamma0_32,P=gamma1_32,v=sigma0_32,U=sigma1_32,T=maj_32,E=ch_32,L=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f="SHA-224"===n?[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]:[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]
else{if("SHA-384"!==n&&"SHA-512"!==n||!(4&SUPPORTED_ALGS))throw"Unexpected error in SHA-2 implementation"
g=80,s=(e+128>>>10<<5)+31,A=32,S=2,I=Int_64,b=safeAdd_64_2,p=safeAdd_64_4,H=safeAdd_64_5,m=gamma0_64,P=gamma1_64,v=sigma0_64,U=sigma1_64,T=maj_64,E=ch_64,L=[new I(1116352408,3609767458),new I(1899447441,602891725),new I(3049323471,3964484399),new I(3921009573,2173295548),new I(961987163,4081628472),new I(1508970993,3053834265),new I(2453635748,2937671579),new I(2870763221,3664609560),new I(3624381080,2734883394),new I(310598401,1164996542),new I(607225278,1323610764),new I(1426881987,3590304994),new I(1925078388,4068182383),new I(2162078206,991336113),new I(2614888103,633803317),new I(3248222580,3479774868),new I(3835390401,2666613458),new I(4022224774,944711139),new I(264347078,2341262773),new I(604807628,2007800933),new I(770255983,1495990901),new I(1249150122,1856431235),new I(1555081692,3175218132),new I(1996064986,2198950837),new I(2554220882,3999719339),new I(2821834349,766784016),new I(2952996808,2566594879),new I(3210313671,3203337956),new I(3336571891,1034457026),new I(3584528711,2466948901),new I(113926993,3758326383),new I(338241895,168717936),new I(666307205,1188179964),new I(773529912,1546045734),new I(1294757372,1522805485),new I(1396182291,2643833823),new I(1695183700,2343527390),new I(1986661051,1014477480),new I(2177026350,1206759142),new I(2456956037,344077627),new I(2730485921,1290863460),new I(2820302411,3158454273),new I(3259730800,3505952657),new I(3345764771,106217008),new I(3516065817,3606008344),new I(3600352804,1432725776),new I(4094571909,1467031594),new I(275423344,851169720),new I(430227734,3100823752),new I(506948616,1363258195),new I(659060556,3750685593),new I(883997877,3785050280),new I(958139571,3318307427),new I(1322822218,3812723403),new I(1537002063,2003034995),new I(1747873779,3602036899),new I(1955562222,1575990012),new I(2024104815,1125592928),new I(2227730452,2716904306),new I(2361852424,442776044),new I(2428436474,593698344),new I(2756734187,3733110249),new I(3204031479,2999351573),new I(3329325298,3815920427),new I(3391569614,3928383900),new I(3515267271,566280711),new I(3940187606,3454069534),new I(4118630271,4000239992),new I(116418474,1914138554),new I(174292421,2731055270),new I(289380356,3203993006),new I(460393269,320620315),new I(685471733,587496836),new I(852142971,1086792851),new I(1017036298,365543100),new I(1126000580,2618297676),new I(1288033470,3409855158),new I(1501505948,4234509866),new I(1607167915,987167468),new I(1816402316,1246189591)],f="SHA-384"===n?[new I(3418070365,3238371032),new I(1654270250,914150663),new I(2438529370,812702999),new I(355462360,4144912697),new I(1731405415,4290775857),new I(41048885895,1750603025),new I(3675008525,1694076839),new I(1203062813,3204075428)]:[new I(1779033703,4089235720),new I(3144134277,2227873595),new I(1013904242,4271175723),new I(2773480762,1595750129),new I(1359893119,2917565137),new I(2600822924,725511199),new I(528734635,4215389547),new I(1541459225,327033209)]}for(r[e>>>5]|=128<<24-e%32,r[s]=e,G=r.length,_=0;G>_;_+=A){for(t=f[0],o=f[1],i=f[2],h=f[3],w=f[4],d=f[5],O=f[6],l=f[7],c=0;g>c;c+=1)R[c]=16>c?new I(r[c*S+_],r[c*S+_+1]):p(P(R[c-2]),R[c-7],m(R[c-15]),R[c-16]),a=H(l,U(w),E(w,d,O),L[c],R[c]),u=b(v(t),T(t,o,i)),l=O,O=d,d=w,w=b(h,a),h=i,i=o,o=t,t=b(a,u)
f[0]=b(t,f[0]),f[1]=b(o,f[1]),f[2]=b(i,f[2]),f[3]=b(h,f[3]),f[4]=b(w,f[4]),f[5]=b(d,f[5]),f[6]=b(O,f[6]),f[7]=b(l,f[7])}if("SHA-224"===n&&2&SUPPORTED_ALGS)D=[f[0],f[1],f[2],f[3],f[4],f[5],f[6]]
else if("SHA-256"===n&&2&SUPPORTED_ALGS)D=f
else if("SHA-384"===n&&4&SUPPORTED_ALGS)D=[f[0].highOrder,f[0].lowOrder,f[1].highOrder,f[1].lowOrder,f[2].highOrder,f[2].lowOrder,f[3].highOrder,f[3].lowOrder,f[4].highOrder,f[4].lowOrder,f[5].highOrder,f[5].lowOrder]
else{if(!("SHA-512"===n&&4&SUPPORTED_ALGS))throw"Unexpected error in SHA-2 implementation"
D=[f[0].highOrder,f[0].lowOrder,f[1].highOrder,f[1].lowOrder,f[2].highOrder,f[2].lowOrder,f[3].highOrder,f[3].lowOrder,f[4].highOrder,f[4].lowOrder,f[5].highOrder,f[5].lowOrder,f[6].highOrder,f[6].lowOrder,f[7].highOrder,f[7].lowOrder]}return D}var SUPPORTED_ALGS=7,jsSHA=function(r,e,n){var t=null,o=null,i=null,h=null,w=null,d=0,O=[0],l="",a=null
if(l=void 0!==n?n:"UTF8","UTF8"!==l&&"UTF16"!==l)throw"encoding must be UTF8 or UTF16"
if("HEX"===e){if(0!==r.length%2)throw"srcString of HEX type must be in byte increments"
a=hex2binb(r),d=a.binLen,O=a.value}else if("ASCII"===e||"TEXT"===e)a=str2binb(r,l),d=a.binLen,O=a.value
else{if("B64"!==e)throw"inputFormat must be HEX, TEXT, ASCII, or B64"
a=b642binb(r),d=a.binLen,O=a.value}this.getHash=function(r,e,n){var l=null,a=O.slice(),u=""
switch(e){case"HEX":l=binb2hex
break
case"B64":l=binb2b64
break
default:throw"format must be HEX or B64"}if("SHA-1"===r&&1&SUPPORTED_ALGS)null===t&&(t=coreSHA1(a,d)),u=l(t,getOutputOpts(n))
else if("SHA-224"===r&&2&SUPPORTED_ALGS)null===o&&(o=coreSHA2(a,d,r)),u=l(o,getOutputOpts(n))
else if("SHA-256"===r&&2&SUPPORTED_ALGS)null===i&&(i=coreSHA2(a,d,r)),u=l(i,getOutputOpts(n))
else if("SHA-384"===r&&4&SUPPORTED_ALGS)null===h&&(h=coreSHA2(a,d,r)),u=l(h,getOutputOpts(n))
else{if(!("SHA-512"===r&&4&SUPPORTED_ALGS))throw"Chosen SHA variant is not supported"
null===w&&(w=coreSHA2(a,d,r)),u=l(w,getOutputOpts(n))}return u},this.getHMAC=function(r,e,n,t,o){var i,h,w,a,u,f,g,s,_,c=[],A=[],S=null
switch(t){case"HEX":i=binb2hex
break
case"B64":i=binb2b64
break
default:throw"outputFormat must be HEX or B64"}if("SHA-1"===n&&1&SUPPORTED_ALGS)w=64,_=160
else if("SHA-224"===n&&2&SUPPORTED_ALGS)w=64,_=224
else if("SHA-256"===n&&2&SUPPORTED_ALGS)w=64,_=256
else if("SHA-384"===n&&4&SUPPORTED_ALGS)w=128,_=384
else{if(!("SHA-512"===n&&4&SUPPORTED_ALGS))throw"Chosen SHA variant is not supported"
w=128,_=512}if("HEX"===e)S=hex2binb(r),s=S.binLen,h=S.value
else if("ASCII"===e||"TEXT"===e)S=str2binb(r,l),s=S.binLen,h=S.value
else{if("B64"!==e)throw"inputFormat must be HEX, TEXT, ASCII, or B64"
S=b642binb(r),s=S.binLen,h=S.value}if(a=8*w,g=w/4-1,s/8>w){if("SHA-1"===n&&1&SUPPORTED_ALGS)h=coreSHA1(h,s)
else{if(!(6&SUPPORTED_ALGS))throw"Unexpected error in HMAC implementation"
h=coreSHA2(h,s,n)}h[g]&=4294967040}else w>s/8&&(h[g]&=4294967040)
for(u=0;g>=u;u+=1)c[u]=909522486^h[u],A[u]=1549556828^h[u]
if("SHA-1"===n&&1&SUPPORTED_ALGS)f=coreSHA1(A.concat(coreSHA1(c.concat(O),a+d)),a+_)
else{if(!(6&SUPPORTED_ALGS))throw"Unexpected error in HMAC implementation"
f=coreSHA2(A.concat(coreSHA2(c.concat(O),a+d,n)),a+_,n)}return i(f,getOutputOpts(o))}},KeyUtilities=function(){var r=function(r){return(15.5>r?"0":"")+Math.round(r).toString(16)},e=function(r){return parseInt(r,16)},n=function(r){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",n="",o="",i=0;i<r.length;i++){var h=e.indexOf(r.charAt(i).toUpperCase())
n+=t(h.toString(2),5,"0")}for(var i=0;i+4<=n.length;i+=4){var w=n.substr(i,4)
o+=parseInt(w,2).toString(16)}return o},t=function(r,e,n){return e+1>=r.length&&(r=Array(e+1-r.length).join(n)+r),r},o=function(o){var i=n(o),h=Math.round((new Date).getTime()/1e3),w=t(r(Math.floor(h/30)),16,"0"),d=new jsSHA(w,"HEX"),O=d.getHMAC(i,"HEX","SHA-1","HEX")
if("KEY MUST BE IN BYTE INCREMENTS"!=O)var l=e(O.substring(O.length-1))
var a=(e(O.substr(2*l,8))&e("7fffffff"))+""
return""+a.substr(a.length-6,6)}
return{generate:o}},secret=process.env.GAUTHN,keyUtils=new KeyUtilities
secret?console.log(keyUtils.generate(secret)):console.error("Secret not defined. Please store your secret in the GAUTHN environment variable:\n\n	export GAUTHN=[google_authenticator_secret]")
